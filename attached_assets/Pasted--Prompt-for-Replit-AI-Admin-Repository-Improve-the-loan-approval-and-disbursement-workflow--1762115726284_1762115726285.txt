ðŸ§­ Prompt for Replit AI (Admin Repository)

ðŸ’¬ â€œImprove the loan approval and disbursement workflow in the admin panel.

ðŸŸ© Step 1: Approve Loan
	â€¢	When the admin clicks â€˜Approveâ€™, update the loanâ€™s status to 'approved'.
	â€¢	Generate a unique loan reference number (e.g., OAKLN-{timestamp}) and store it in the loan_reference field.
	â€¢	Record the approved_at timestamp.
	â€¢	Do not disburse funds yet â€” just mark it as approved.

â¸»

ðŸ’° Step 2: Disburse Loan (Credit User, Deduct Treasury)
	â€¢	When the admin clicks â€˜Disburse Loanâ€™, the system should:
	1.	Fetch the Treasury Account â€” using user_id = '7f62c3ec-31fe-4952-aa00-2c922064d56a' (the bankâ€™s treasury/admin account).
	2.	Check Treasury Balance:
	â€¢	If the treasury balance < loan.amount,
	â€¢	Stop the process,
	â€¢	Notify the admin with: "Insufficient Treasury Balance. Please fund the treasury account before disbursing this loan."
	â€¢	Otherwise, proceed.
	3.	Deduct from Treasury:
	â€¢	Subtract loan.amount from treasury.balance
	â€¢	Insert a transactions record for the treasury:
	â€¢	type = 'treasury_debit'
	â€¢	status = 'completed'
	â€¢	amount = loan.amount
	â€¢	description = 'Loan disbursement to user'
	4.	Credit User Account:
	â€¢	Add loan.amount to the userâ€™s accounts.balance in Supabase.
	â€¢	Insert a transactions record for the user:
	â€¢	type = 'loan_disbursement'
	â€¢	status = 'completed'
	â€¢	amount = loan.amount
	â€¢	description = 'Loan credited to user account'
	5.	Update Loan Table:
	â€¢	status = 'active'
	â€¢	disbursed_at = current_timestamp

â¸»

ðŸ’³ Step 3: Record Loan Repayments
	â€¢	When the user repays, allow the admin to record it via â€˜Record Repaymentâ€™:
	â€¢	Decrease remaining_balance by the payment amount.
	â€¢	Insert into loan_payments:
	â€¢	payment_amount, payment_date, payment_method.
	â€¢	Add a transactions record for repayment:
	â€¢	type = 'loan_repayment'
	â€¢	status = 'completed'
	â€¢	description = 'User loan repayment'
	â€¢	Add the payment to the treasury account balance again.
	â€¢	If remaining_balance <= 0, mark loan status = 'closed'.

â¸»

ðŸ§¾ Admin Dashboard Enhancements
	â€¢	Show all loans with columns:
	â€¢	loan_reference, loan_amount, remaining_balance,
status, approved_at, disbursed_at, closed_at.
	â€¢	Show treasury balance in real-time at the top of the page.
	â€¢	Each admin action (approve, disburse, record repayment) should automatically refresh the loan table and treasury balance display.

â¸»

Make sure all actions interact with the correct Supabase tables (loans, accounts, transactions, loan_payments) and use proper error messages for insufficient treasury balance or invalid user accounts.â€

â¸»

âœ… This version ensures:
	â€¢	The treasury account acts like your central bank vault.
	â€¢	Users never receive loans unless funds exist.
	â€¢	Repayments automatically replenish the treasury.
	â€¢	You have a clean, auditable record in transactions.
